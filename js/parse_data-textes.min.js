var rows,allResults,title,content,tableBody,tableBodyStart=document.getElementsByTagName("tbody")[0].innerHTML,urls=["https://raw.githubusercontent.com/eyssette/textes-philo/main/data/textes-ce.tsv","https://raw.githubusercontent.com/eyssette/textes-philo/main/data/textes-gren.tsv","https://raw.githubusercontent.com/eyssette/textes-philo/main/data/textes-maphil.tsv","https://raw.githubusercontent.com/eyssette/textes-philo/main/data/textes-mater.tsv","https://raw.githubusercontent.com/eyssette/textes-philo/main/data/textes-collected.tsv","https://raw.githubusercontent.com/eyssette/textes-philo/main/data/textes-haut.tsv","https://raw.githubusercontent.com/eyssette/textes-philo/main/data/textes-bac.tsv"];Promise.all(urls.map(e=>new Promise((t,r)=>Papa.parse(e,{download:!0,header:!1,delimiter:"    ",complete:t,error:r})))).then(function(e){rows=e[0].data;for(let t=1;t<urls.length;t++)rows=rows.concat(e[t].data)}).catch(e=>console.warn("Something went wrong:",e));var input=document.getElementById("recherche_dans_le_sujet");input.oninput=handleInput;let checker=(e,t)=>t.every(t=>e.includes(t));function handleInput(e){var t=input.value.toLowerCase();this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){if(t.length>2){searchItems=t.split("+"),tableBody="<tbody>",rows.forEach(e=>{cellules=e[0].split("\t"),source=cellules.toString().toLowerCase(),checker(source,searchItems)&&(scorePertinence=0,searchItems.forEach(e=>{regex=new RegExp("\\b"+e+"\\b","gi"),nombreOccurrencesTexte=cellules[2].toLowerCase().split(e).length-1,nombreOccurrencesTextePerfectMatch=nombreOccurrencesTexte+2*(cellules[0].toLowerCase().match(regex)||[]).length,scorePertinence+=2*(nombreOccurrencesTexte+nombreOccurrencesTextePerfectMatch),nombreOccurrencesAuteur=cellules[0].toLowerCase().split(e).length-1,nombreOccurrencesAuteurPerfectMatch=nombreOccurrencesAuteur+2*(cellules[0].toLowerCase().match(regex)||[]).length,scorePertinence+=3*(nombreOccurrencesAuteur+nombreOccurrencesAuteurPerfectMatch),cellules[3]&&(nombreOccurrencesPrecisions=cellules[3].toLowerCase().split(e).length-1,scorePertinence+=nombreOccurrencesPrecisions),cellules[1]&&(nombreOccurrencesReference=cellules[1].toLowerCase().split(e).length-1,scorePertinence+=nombreOccurrencesReference)}),texte="« "+cellules[2]+" »",tableBody+="<tr>",auteur="<br/><b>"+cellules[0]+"</b>",cellules[1]?reference=", "+cellules[1]:reference="",cellules[3]?precisions="<br/>"+cellules[3]:precisions="",tableBody=tableBody+"<td>"+auteur+"</td><td>"+texte+auteur+reference+precisions+"</td><td>"+scorePertinence+"</td>",tableBody+="</tr>")}),tableBody+="</tbody>",document.getElementsByTagName("tbody")[0].innerHTML=tableBody;var e=document.getElementById("content");new Mark(e).mark(searchItems,options={accuracy:"complementary",separateWordSearch:!1}),fdTableSort.init("textes"),fdTableSort.jsWrapper("textes",[2,0])}else document.getElementsByTagName("tbody")[0].innerHTML=tableBodyStart},350)}